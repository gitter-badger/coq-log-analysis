# Use the byte-code compiler
BYTE_ENABLED = true
NATIVE_ENABLED = false
OCAMLCFLAGS += -g -thread -annot

USE_OCAMLFIND = true
OCAMLPACKS[] = batteries

FILES = parselog

.PHONY: clean distclean run run1

clean:
	rm -f *.cmo *.cmi parselog *.run *.dot *.pdf

samples/refine.dot: parselog OMakefile
	./parselog -d -x -f samples/refine.txt.out -o samples/refine.dot

samples/refine.pdf: samples/refine.dot OMakefile
	dot -Tpdf samples/refine.dot -osamples/refine.pdf

samples/refine.svg: samples/refine.dot OMakefile
	dot -Tsvg samples/refine.dot -osamples/refine.svg

samples/refine_fail.dot: parselog OMakefile
	./parselog -d -x -f samples/refine_fail.txt.out -o samples/refine_fail.dot

samples/refine_fail.pdf: samples/refine_fail.dot OMakefile
	dot -Tpdf samples/refine_fail.dot -osamples/refine_fail.pdf

samples/refine_fail.svg: samples/refine_fail.dot OMakefile
	dot -Tsvg samples/refine_fail.dot -osamples/refine_fail.svg

# helpers
run: samples/refine.pdf
	xpdf samples/refine.pdf

runs: samples/refine.svg
	geeqie samples/refine.svg

run1: samples/refine_fail.pdf
	xpdf samples/refine_fail.pdf

run1s: samples/refine_fail.svg
	geeqie samples/refine_fail.svg



#Build the program
OCamlProgram(parselog, $(FILES))
.DEFAULT: parselog

