# Use the byte-code compiler
BYTE_ENABLED = true
NATIVE_ENABLED = false
OCAMLCFLAGS += -g -thread -annot

USE_OCAMLFIND = true
OCAMLPACKS[] = batteries

FILES = parselog

.PHONY: clean distclean run run1

clean:
	rm -f *.cmo *.cmi parselog *.run *.dot *.pdf

refine.dot: parselog OMakefile
	./parselog -d -x -f ../refine.txt.out -o refine.dot

refine.pdf: refine.dot OMakefile
	dot -Tpdf refine.dot -orefine.pdf

refine.svg: refine.dot OMakefile
	dot -Tsvg refine.dot -orefine.svg

refine_fail.dot: parselog OMakefile
	./parselog -d -x -f ../refine_fail.txt.out -o refine_fail.dot

refine_fail.pdf: refine_fail.dot OMakefile
	dot -Tpdf refine_fail.dot -orefine_fail.pdf

refine_fail.svg: refine_fail.dot OMakefile
	dot -Tsvg refine_fail.dot -orefine_fail.svg

# helpers
run: refine.pdf
	xpdf refine.pdf

runs: refine.svg
	geeqie refine.svg

run1: refine_fail.pdf
	xpdf refine_fail.pdf

run1s: refine_fail.svg
	geeqie refine_fail.svg



#Build the program
OCamlProgram(parselog, $(FILES))
.DEFAULT: parselog

